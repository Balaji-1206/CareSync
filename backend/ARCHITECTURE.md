# CareSync Vitals System - Architecture Diagram

## ğŸ—ï¸ 8-Layer Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     FRONTEND DASHBOARD                           â”‚
â”‚        (React Component - Separate Integration)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ JSON Requests
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  LAYER 1: DATA RECEPTION                         â”‚
â”‚              POST /api/vitals/data                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â€¢ Validate HR, SpO2, Temp, RR, Fall                        â”‚ â”‚
â”‚  â”‚ â€¢ Check required fields                                     â”‚ â”‚
â”‚  â”‚ â€¢ Extract patientId                                        â”‚ â”‚
â”‚  â”‚ â€¢ Timestamp each reading                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               LAYER 2: LATEST STATE CACHE                        â”‚
â”‚          (In-Memory Dictionary - Node.js)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ {                                                           â”‚ â”‚
â”‚  â”‚   "patientId": {                                            â”‚ â”‚
â”‚  â”‚     "HR": { value: 82, time: "10:00:02Z" },               â”‚ â”‚
â”‚  â”‚     "SpO2": { value: 96, time: "10:00:02Z" },             â”‚ â”‚
â”‚  â”‚     "Temp": { value: 37.1, time: "10:00:01Z" },           â”‚ â”‚
â”‚  â”‚     "RR": { value: 18, time: "10:00:01Z" },               â”‚ â”‚
â”‚  â”‚     "Fall": { value: 0, time: "10:00:02Z" }               â”‚ â”‚
â”‚  â”‚   }                                                         â”‚ â”‚
â”‚  â”‚ }                                                           â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚ âœ… Always ready for EWS calculation                        â”‚ â”‚
â”‚  â”‚ âœ… Updated on each POST request                            â”‚ â”‚
â”‚  â”‚ âœ… Can serve different patients                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  Source: src/utils/vitalCache.js                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Auto-trigger every 5 seconds
                           â”‚ (per patient)
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            LAYER 3: EWS TIMER & SCHEDULER                        â”‚
â”‚          startEWSTimer(patientId) - setInterval()                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Every 5 seconds:                                            â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚ â”‚ calculateAndSaveEWS(patientId)                      â”‚    â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â”‚          â”‚                                                  â”‚ â”‚
â”‚  â”‚          â–¼                                                  â”‚ â”‚
â”‚  â”‚    Check Staleness                                         â”‚ â”‚
â”‚  â”‚          â”‚                                                  â”‚ â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                                          â”‚ â”‚
â”‚  â”‚    â”‚             â”‚                                          â”‚ â”‚
â”‚  â”‚    â–¼             â–¼                                          â”‚ â”‚
â”‚  â”‚  Stale       Valid                                         â”‚ â”‚
â”‚  â”‚    â”‚             â”‚                                          â”‚ â”‚
â”‚  â”‚    â”‚             â–¼                                          â”‚ â”‚
â”‚  â”‚    â”‚      Get Vitals from Cache                           â”‚ â”‚
â”‚  â”‚    â”‚             â”‚                                          â”‚ â”‚
â”‚  â”‚    â”‚             â–¼                                          â”‚ â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â–º Run 3 Models                                  â”‚ â”‚
â”‚  â”‚             â”‚                                              â”‚ â”‚
â”‚  â”‚             â–¼                                              â”‚ â”‚
â”‚  â”‚      Combine Results                                      â”‚ â”‚
â”‚  â”‚             â”‚                                              â”‚ â”‚
â”‚  â”‚             â–¼                                              â”‚ â”‚
â”‚  â”‚      Save to MongoDB                                      â”‚ â”‚
â”‚  â”‚             â”‚                                              â”‚ â”‚
â”‚  â”‚             â–¼                                              â”‚ â”‚
â”‚  â”‚      Update Historical Data                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  Source: src/controllers/vitalsController.js                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
        â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LAYER 4        â”‚   â”‚    LAYER 5           â”‚
â”‚ STALENESS CHECK  â”‚   â”‚  3-MODEL COMBINATION â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ HR:     5 sec    â”‚   â”‚ â€¢ EWS Model          â”‚
â”‚ SpO2:   5 sec    â”‚   â”‚   â†“ Normal/Warning/  â”‚
â”‚ Temp:   10 sec   â”‚   â”‚   Critical           â”‚
â”‚ RR:     8 sec    â”‚   â”‚                      â”‚
â”‚ Fall:   3 sec    â”‚   â”‚ â€¢ Anomaly Model      â”‚
â”‚                  â”‚   â”‚   â†“ Normal/Abnormal  â”‚
â”‚ If ANY stale:    â”‚   â”‚                      â”‚
â”‚ â†’ Skip calc      â”‚   â”‚ â€¢ Trend Model        â”‚
â”‚ â†’ Mark Stale     â”‚   â”‚   â†“ Stable/Decliningâ”‚
â”‚ â†’ Log "waiting"  â”‚   â”‚   /Improving         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                      â”‚
                       â”‚ Final Decision:      â”‚
                       â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                       â”‚ â”‚ High Risk       â”‚  â”‚
                       â”‚ â”‚ Monitor         â”‚  â”‚
                       â”‚ â”‚ Stable          â”‚  â”‚
                       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                       â”‚                      â”‚
                       â”‚ Source: src/utils/   â”‚
                       â”‚ mockModels.js        â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              LAYER 6: DATABASE STORAGE                           â”‚
â”‚                    MongoDB Atlas/Local                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ VitalReading Collection:                                   â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚ {                                                           â”‚ â”‚
â”‚  â”‚   _id: ObjectId,                                            â”‚ â”‚
â”‚  â”‚   patientId: ObjectId,    â† References User                â”‚ â”‚
â”‚  â”‚   vitals: {                                                 â”‚ â”‚
â”‚  â”‚     HR: { value, time },                                    â”‚ â”‚
â”‚  â”‚     SpO2: { value, time },                                  â”‚ â”‚
â”‚  â”‚     Temp: { value, time },                                  â”‚ â”‚
â”‚  â”‚     RR: { value, time },                                    â”‚ â”‚
â”‚  â”‚     Fall: { value, time }                                   â”‚ â”‚
â”‚  â”‚   },                                                         â”‚ â”‚
â”‚  â”‚   calculation: {                                            â”‚ â”‚
â”‚  â”‚     EWS: { result, timestamp },                            â”‚ â”‚
â”‚  â”‚     Anomaly: { result, timestamp },                        â”‚ â”‚
â”‚  â”‚     Trend: { result, timestamp }                           â”‚ â”‚
â”‚  â”‚   },                                                         â”‚ â”‚
â”‚  â”‚   finalStatus: "Stable|Monitor|High Risk",                 â”‚ â”‚
â”‚  â”‚   processingStatus: "Processed|Stale|Incomplete",          â”‚ â”‚
â”‚  â”‚   stalePitals: [],                                         â”‚ â”‚
â”‚  â”‚   recordedAt: Date                                          â”‚ â”‚
â”‚  â”‚ }                                                           â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚ Indexes: patientId, patientId+recordedAt                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  Source: src/models/VitalReading.js                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚             â”‚
                    â–¼             â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  LAYER 7        â”‚  â”‚  Serving Data       â”‚
         â”‚ TREND ANALYSIS  â”‚  â”‚  (via API)          â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Keep last 30    â”‚          â”‚
         â”‚ readings per    â”‚          â”‚ GET /latest
         â”‚ patient         â”‚          â”‚ GET /ews-status
         â”‚                 â”‚          â”‚ GET /history
         â”‚ Compare:        â”‚          â”‚
         â”‚ â€¢ First half    â”‚          â–¼
         â”‚   vs            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ â€¢ Second half   â”‚  â”‚   LAYER 8            â”‚
         â”‚                 â”‚  â”‚  OUTPUT LAYER        â”‚
         â”‚ Detect:         â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚ â€¢ Declining     â”‚  â”‚ {                    â”‚
         â”‚ â€¢ Improving     â”‚  â”‚   "EWS": "...",      â”‚
         â”‚ â€¢ Stable        â”‚  â”‚   "Anomaly": "...",  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   "Trend": "...",    â”‚
                              â”‚   "Final_Status":    â”‚
                              â”‚   "Final Result",    â”‚
                              â”‚   "Last_Update":     â”‚
                              â”‚   "timestamp"        â”‚
                              â”‚ }                    â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚  FRONTEND UPDATES   â”‚
                           â”‚  Dashboard Display  â”‚
                           â”‚  Real-time Alerts   â”‚
                           â”‚  Historical Graphs  â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow Sequence

```
TIMELINE:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

t=0s   â–¼
       POST /api/vitals/data
         â”œâ”€ Validate input
         â”œâ”€ Update Cache
         â”œâ”€ Start Timer (if first time)
         â””â”€ Return cached state (immediate)

       âœ… Response to client within milliseconds

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

t=0-5s â”‚ (Timer counting down)

       â”œâ”€ Sensors can keep sending data
       â””â”€ Cache keeps updating for latest values

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

t=5s   â–¼ TIMER FIRES
       calculateAndSaveEWS()
         â”œâ”€ checkStaleness()
         â”‚  â””â”€ If stale â†’ Save as "Stale", STOP
         â”‚
         â”œâ”€ Get current vitals from Cache
         â”œâ”€ Run 3 Models:
         â”‚  â”œâ”€ ewsModel() â†’ "Normal|Warning|Critical"
         â”‚  â”œâ”€ anomalyModel() â†’ "Normal|Abnormal"
         â”‚  â””â”€ trendModel() â†’ "Stable|Declining|Improving"
         â”‚
         â”œâ”€ Combine results â†’ finalStatus
         â”œâ”€ Update historical data (keep 30)
         â””â”€ Save to MongoDB

       ğŸ“Š Record saved to database

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

t=5-10sâ”‚ (Timer counting down again)

       â”œâ”€ Client can GET /latest (cache)
       â”œâ”€ Client can GET /ews-status (from latest DB record)
       â””â”€ Cache updates continue

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

t=10s  â–¼ TIMER FIRES AGAIN
       (Process repeats every 5 seconds indefinitely)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ“¡ API Call Map

```
                    CLIENT
                      â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚            â”‚            â”‚
         â–¼            â–¼            â–¼
    POST /data   GET /latest  GET /ews-status
         â”‚            â”‚            â”‚
         â”‚            â”‚            â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚                                    â”‚
    â”‚     EXPRESS SERVER PORT 5000       â”‚
    â”‚                                    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                    â”‚
    â”‚  vitalsController.js               â”‚
    â”‚  â”œâ”€ receiveVitalData()             â”‚
    â”‚  â”œâ”€ getLatestVitals()              â”‚
    â”‚  â”œâ”€ getEWSStatus()                 â”‚
    â”‚  â”œâ”€ getVitalHistory()              â”‚
    â”‚  â””â”€ calculateAndSaveEWS()          â”‚
    â”‚                                    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                    â”‚
    â”‚  vitalCache.js (In-Memory)         â”‚
    â”‚  â”œâ”€ updateCache()                  â”‚
    â”‚  â”œâ”€ getLatestState()               â”‚
    â”‚  â”œâ”€ checkStaleness()               â”‚
    â”‚  â””â”€ getVitalValuesForModel()       â”‚
    â”‚                                    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                    â”‚
    â”‚  mockModels.js                     â”‚
    â”‚  â”œâ”€ ewsModel()                     â”‚
    â”‚  â”œâ”€ anomalyModel()                 â”‚
    â”‚  â”œâ”€ trendModel()                   â”‚
    â”‚  â””â”€ combinedAnalysis()             â”‚
    â”‚                                    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                    â”‚
    â”‚  MongoDB (Persistence)             â”‚
    â”‚  â””â”€ VitalReading Collection        â”‚
    â”‚                                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚            â”‚            â”‚
         â”‚            â”‚            â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
                   RESPONSE
                   (JSON)
```

---

## ğŸ¯ State Transitions

```
PATIENT MONITORING LIFECYCLE:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                               â”‚
â”‚  1. NEW PATIENT                                              â”‚
â”‚     â””â”€â–º First POST /data                                     â”‚
â”‚         â”œâ”€ Create cache entry                                â”‚
â”‚         â”œâ”€ Start EWS timer                                   â”‚
â”‚         â””â”€ Initialize history array                          â”‚
â”‚                                                              â”‚
â”‚  2. CONTINUOUS MONITORING                                   â”‚
â”‚     â””â”€â–º Every 5 seconds                                      â”‚
â”‚         â”œâ”€ Check staleness                                   â”‚
â”‚         â”‚  â”œâ”€ Valid â†’ Calculate EWS                          â”‚
â”‚         â”‚  â””â”€ Stale â†’ Log warning, skip                      â”‚
â”‚         â”œâ”€ Save to database                                  â”‚
â”‚         â””â”€ Update trend data                                 â”‚
â”‚                                                              â”‚
â”‚  3. DATA RETRIEVAL (ANYTIME)                               â”‚
â”‚     â”œâ”€ GET /latest â†’ From cache (instant)                  â”‚
â”‚     â”œâ”€ GET /ews-status â†’ From latest DB record             â”‚
â”‚     â””â”€ GET /history â†’ From all DB records                  â”‚
â”‚                                                              â”‚
â”‚  4. ALERT GENERATION (AUTOMATIC)                           â”‚
â”‚     â””â”€ When finalStatus != "Stable"                        â”‚
â”‚         â”œâ”€ "Monitor" â†’ Medium priority                      â”‚
â”‚         â””â”€ "High Risk" â†’ High priority                      â”‚
â”‚                                                              â”‚
â”‚  5. END MONITORING                                          â”‚
â”‚     â””â”€ Stop timer, clear cache                             â”‚
â”‚         (Data remains in database)                          â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Decision Logic Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INPUT: Latest Vitals + Historical Data                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Run EWS Model                  â”‚
         â”‚ (Check individual vital ranges)â”‚
         â”‚                                â”‚
         â”‚ Output: "Normal"               â”‚
         â”‚         "Warning"              â”‚
         â”‚         "Critical"             â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Run Anomaly Model              â”‚
         â”‚ (Detect unusual patterns)      â”‚
         â”‚                                â”‚
         â”‚ Output: "Normal"               â”‚
         â”‚         "Abnormal"             â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Run Trend Model                â”‚
         â”‚ (Analyze last 30 readings)     â”‚
         â”‚                                â”‚
         â”‚ Output: "Stable"               â”‚
         â”‚         "Declining"            â”‚
         â”‚         "Improving"            â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ COMBINE RESULTS                             â”‚
    â”‚                                             â”‚
    â”‚ if (EWS = "Critical" OR                    â”‚
    â”‚     Anomaly = "Abnormal" OR                â”‚
    â”‚     Trend = "Declining")                   â”‚
    â”‚   â†’ Final_Status = "High Risk"             â”‚
    â”‚                                             â”‚
    â”‚ else if (EWS = "Warning")                  â”‚
    â”‚   â†’ Final_Status = "Monitor"               â”‚
    â”‚                                             â”‚
    â”‚ else                                        â”‚
    â”‚   â†’ Final_Status = "Stable"                â”‚
    â”‚                                             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OUTPUT: Final_Status (to API response + database)          â”‚
â”‚                                                             â”‚
â”‚ {"Final_Status": "High Risk|Monitor|Stable"}              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Data Security Flow

```
REQUEST VALIDATION:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Incoming Request
        â”‚
        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Validate patientId   â”‚ â† Check if present & valid
  â”‚ required: true       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Validate vitals      â”‚
  â”‚ â”œâ”€ Check all 5       â”‚
  â”‚ â”‚ present            â”‚
  â”‚ â”œâ”€ Check numeric     â”‚
  â”‚ â”‚ values             â”‚
  â”‚ â””â”€ Check timestamps  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ âœ… PASS â†’ Process    â”‚
  â”‚ âŒ FAIL â†’ Reject     â”‚
  â”‚           (400)      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**This architecture ensures reliable, scalable, production-grade vital monitoring! ğŸ¯**
